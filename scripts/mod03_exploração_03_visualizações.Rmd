---
title: "Visualização de Dados"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Bibliotecas

```{r}
library(tidyverse)
```



# ggplot2

A etapa de visualização possui um papel importantíssimo no contexto de análise de dados, Ben Shneiderman, um importante nome da ciência da computação: "Visualização nos dá resposta para perguntas que nós não sabiamos que tinhamos". 

E no R, apesar de existirem muitos recursos default para a visualização de dados, como as funções: `plot()`, `hist()` e `boxplot()`, é quando começamos a trabalhar com as bibliotecas de visualização do R, que o recurso gráfico é realmente potencializado. E sem dúvida o principal pacote para visualização no R, é o `ggplot2`. Neste, trabalhamos com a lógica do *Grammar of Graphics*, uma abstração lógica em que o gráfico é visto como um mapeamento feito por camadas, são elas:

```{r, eval=F}
  dados %>% 
    ggplot(aesthetic) +
      geometries(statistics) +
      facets() +
      coord()
      themes()
```

Contudo apenas três destas são obrigatórias: dados,  atributos estéticos (aesthetic), e objetos geométricos (geometries: pontos, barras, linhas, etc). Vamos começar por eles.


## camadas obrigatórias

Para as camadas obrigatórias, temos um layout similar a este:

```{r, eval=F}
  dados %>% 
    ggplot(aesthetic) +
      geometries() 
```



E para entender melhor do que se tratam, vamos adicioná-los um a um. Vamos utilizar aqui a base `fivethirtyeight::drinks`, e no que ao aplicar o ggplot apenas, temos um painel em branco, com isto podemos entender que esta função tem como papel inicializar o gráfico:

```{r}
fivethirtyeight::drinks %>% head()
```


```{r}
fivethirtyeight::drinks %>% 
  ggplot() 
```
Passamos agora para o elemento `aesthetic`, no R esta função é representada de maneira abreviada, `aes()`. E por ser uma função, podemos pesquisar sobre, e então teremos que este "mapeamento estético" descreve como as variáveis dos dados serão mapeadas para propriedades visuais (estéticas) de geometrias. Não ajudou muito né? Mas traduzindo, o que estamos dizendo é que no `aes()` você indicará qual variável será mapeada no gráfico. Um mapeamente usual trata do eixo x e eixo y:


```{r}
fivethirtyeight::drinks %>% 
  ggplot(aes(x = beer_servings, y = wine_servings)) 
```

Note que agora o gráfico passou a apresentar as variáveis nos eixos, mas nada além disto, por quê? Pois não indicamos como gostariamos que este gráfico apresentasse estes eixos. E para isto temos o nosso terceiro elemento obrigatório, as geometrias:


```{r}
fivethirtyeight::drinks %>% 
  ggplot(aes(x = beer_servings, y = wine_servings)) +
  geom_point()
```
E poderíamos trabalhar com outra geometria. Qualquer uma? Não. Precisaria ser uma geometria que trabalhasse com dois eixos, sendo ambos numéricos, dado as variáveis escolhidas:

```{r}
fivethirtyeight::drinks %>% 
  ggplot(aes(x = beer_servings, y = wine_servings)) +
    #geom_point()
    #geom_area() +
    #geom_bin_2d() +
    #geom_jitter()
    geom_rug()
```

Inclusive podemos usar mais de um layer, e fazendo ajustes nas geometrias de forma independente:

```{r}
fivethirtyeight::drinks %>% 
  ggplot(aes(x = beer_servings, y = wine_servings)) +
    geom_point(aes(color = total_litres_of_pure_alcohol)) +
    #geom_area()
    #geom_bin_2d() +
    #geom_jitter()
    geom_rug(alpha = 0.2)
```

Mas quem são esses? 

```{r}
fivethirtyeight::drinks %>% 
  ggplot(aes(x = beer_servings, y = wine_servings, color = total_litres_of_pure_alcohol)) +
    geom_point() +
    geom_text(aes(label = country))
```


Ruim de ler? 


```{r}
fivethirtyeight::drinks %>% 
  ggplot(aes(x = beer_servings, y = wine_servings, color = total_litres_of_pure_alcohol)) +
    geom_point(alpha = 0.1) +
    geom_text(data = . %>% filter( total_litres_of_pure_alcohol > 10), aes(label = country))
```


```{r}
fivethirtyeight::drinks %>% 
  ggplot(aes(x = beer_servings, y = wine_servings, color = total_litres_of_pure_alcohol)) +
    geom_point(alpha = 0.1) +
    ggrepel::geom_text_repel(data = . %>% filter( total_litres_of_pure_alcohol > 10), aes(label = country))
```

Aqui já estamos utilizando recursos avançados, mas o meu ponto era justo mostrar o quanto a dificuldade não é o código. Mas não se preocupe pois vamos passar por recursos suficientes para que você possa evoluir neste pacote ;)

No mais vale comentar também que o ggplot trabalha com o encadeamento de funções, porém a dinâmica aqui é um pouco diferente do `%>%` e por isso trabalhamos com o operador `+`.



## demais camadas 

Retornando a totalidade da camadas, temos ainda os níveis em que podemos fazer: a divisão de gráficos (faceting), sistemas de coordenadas (coord), temas de fundo (themes), e sumarizações estatísticas (statistics).


```{r, eval=F}
  dados %>% 
    ggplot(aesthetic) +
      geometries(statistics) +
      facets() +
      coord()
      themes()
```


E aqui vale dar uma checada na cheat sheet do ggplot, pois ela nos dá dicas valiosas sobre quais geometrias você pode ou não aplicar a depender do tipo da variável, além de sobre as demais camadas: 


```{r , echo=FALSE, fig.align = "center", fig.cap="CheatSheet ggplot2 (folha 01)"}
knitr::include_graphics('https://i.pinimg.com/originals/5d/f0/dd/5df0dd5a1c5751f039b8db8ad9267cb5.jpg')
```



# E como aprender tudo isso? 

Treinando, e usando o pacote `esquisser()` ;) 


# E como escolher: 



Adicionalmente, segue um exemplo considerando a base `diamonds`, onde o interesse é entender a distribuição da variável `cut` em relação à `clarity`, ou ambas quanto a `count`:  

```{r}
#visualização dos dados
  diamonds %>% glimpse
```

```{r}
# visualização 1
  diamonds %>% 
    ggplot(aes(x = cut, fill = clarity)) + 
    geom_bar()
```


```{r}
# visualização 2
  diamonds %>% 
    ggplot(aes(x = cut,  y = price)) + 
    geom_bar(aes(fill = clarity), 
             stat = "identity", 
             position = "fill")
  
```



# Por fim segue um exemplo de dados temporais em que, em conjunto com as funções do `tidyr` e `dplyr`, remodelamos a base de dados `economics` visando obter a visualização das variáveis `psavert` e `uempmed` desde `1990`:

```{r}
economics
```

```{r}
economics %>%
  select(date, psavert, uempmed) %>%
  filter(date>1990) %>% 
  gather(key = "variable", value = "value", -date) %>% 
  ggplot(aes(x = date, y = value)) + 
  geom_line(aes(color = variable), size = 1) +
  scale_color_manual(values = c("#00AFBB", "#E7B800")) 
```



# Tabelas

Por tras de todo grande gráfico temos uma grande tabela:

uma vez que, quando devidamente utilizada, nos permite um entendimento muito mais profundo entendimento dos dados e suas particularidades. Apesar da visualização também contemplar  um conjunto de medidas organizadas em tabelas, vamos focar este capítulo na opção gráfica, visto já termos apresentado o pacote `dplyr`, e funções de sumarização como o `summarise()` - um pacote particularmente útil para visualizações descritivas é o `skimr`.


kableExtra
Para mais detalhes, consulte o link: https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html

```{r}
starwars %>% 
  janitor::tabyl(hair_color ) %>% 
  kableExtra::kbl() %>%
  kableExtra::kable_styling()
```

```{r}
starwars %>% 
  janitor::tabyl(hair_color) %>% 
  dplyr::arrange(-n) %>% 
  dplyr::mutate(percent = scales::percent(percent)) %>% 
  dplyr::mutate(valid_percent = scales::percent(valid_percent)) 
```



# Hands-on


No RStudio Learn Primers: https://rstudio.cloud/learn/primers, faça os exercícios propostos na aba Work with Data, priorizando a seção Derive Information with dplyr em https://rstudio.cloud/learn/primers/2.3

https://rstudio.cloud/learn/primers/3 

Visualize Data



