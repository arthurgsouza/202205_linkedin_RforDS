---
title: "Importação de Dados"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = TRUE)
```

# Bibliotecas

```{r}
library(tidyverse)
```


# Importando dados tabulares

A etapa de importação de dados pode significar ler dados armazenados em arquivos de diferentes extensões, provenientes de outras ferramentas, APIs da Web, e etc. Aqui iremos dar enfoque na leitura de dados tabulares, isto é, arquivos que possuem características retangulares, como por exemplo arquivos excel ou .csv. 


## Via point-and-click
Para a leitura de arquivos tabulares, vamos primeiro considerar a opção Point-and-Click:
`File > Import Dataset > From ... `, onde você poderá definir as especificações de leitura, mas tendo acesso aos comandos referentes as instruções dadas. De modo que você possa não apenas aprender os respectivos códigos, como também e principalmente garantir a reprodutibilidade da leitura.  

Uma alternativa menos replicável é por meio do comando `file.choose()`, que abre um pop-up, onde você pode selecionar o seu arquivo de interesse.


```{r}
#file.choose()
```


## Via código
Apesar do R possuir várias funções default para leitura de dados, como `read.table()` por exemplo, daremos enfoque aqui as funções do pacote `readr` – uma das bibliotecas do tidyverse. Abaixo seguem alguns exemplos para a leitura de um arquivo que denominaremos de forma genérica como "file" – assumindo que este esteja no seu diretório corrente de trabalho, considerando diferentes possíveis extensões e delimitadores que este arquivo possa vir a ter:

* read_csv("file.csv") - lê arquivos delimitados por vírgula
* read_csv2("file.csv") - lê arquivos delimitados por ponto e vírgula
* read_delim("file.txt", delim="|") - lê arquivos delimitados por tabulação (exemplo dado para o delimitador |)
* read_fwf("file.fwf", col_positions = c(1,3,5)) - lê arquivos com largura fixa (exemplo dado para o padrão 1,3,5)

Importante ressaltar que em todos os casos é possível especificar características do arquivo, por meio de parâmetros como: nome das colunas, cabeçalho, linhas para serem puladas, ou ainda a pré-especificação da classe de cada uma das colunas do arquivo. Contudo, no caso deste último parâmetro não ser listado, as funções do `readr` irão “adivinhar” a classe das colunas, retornando uma mensagem com tais informações. 

Como exemplo vamos utilizar um dos arquivos de exemplo do próprio pacote:

```{r}
read_csv(readr_example("mtcars.csv"))
#dica: explore as demais opções da função `readr_example`
```

# Importando outros tipos de dados

O R dispõe de uma larga gama de bibliotecas relacionadas à leitura de dados:

- readxl: para arquivos .xls e .xlsx.
- feather: para compartilhar arquivos com Python e outras linguagens.
- haven: para trabalhar com arquivos do SPSS, SAS e Stata.
- httr: para web apps.
- jsonlite: para JSON arquivos.
- rvest: para web scraping.
- xml2: para XML.


Além de  `DBI`, `sparklyr`, esta última particularmente interessante no contexto de Big Data.




# Salvando e lendo arquivos

Vamos inicialmente escrever um arquivo, e então vamos ler novamente.

Com a função `write_csv()`, também do pacote `readr` tendo como parametros o nome do objeto a ser exportado e o path, ou seja, o caminho onde você espera que o arquivo criado seja salvo. 

```{r}
state <- mtcars

#exporte os dados em um arquivo .csv
write_csv(state, "base_exportada.csv")
```


Para saber qual o diretório de trabalho corrente, utilizamos o comando `getwd()` (*get working directory*) 

```{r}
getwd()
```

Enquanto que para alterar o diretório de trabalho temos a função `setwd()` (*set working directory*).


```{r}
#C:\\Users\\natyd\\Desktop
setwd("C:/Users/natyd/Desktop")
```

Para a leitura de arquivos: `read_table`. Vamos ler o objeto que foi salvo, em um novo objeto.

```{r}
state1 <- read_csv("base_exportada.csv")
state1
```

Alternativamente podemos especificar o destino do arquivo de interesse, precedendo o nome do arquivo com o diretório desejado, p.e.: `write_delim(mtcars, file = "C:/Users/mtcars.txt")` note que trabalhamos com barras simples (`/` ou `\\`) para especificação de diretórios.

E assim como as demais funções, temos uma série de parâmetros, permitindo especificações de separadores, títulos e comentários, além de variações de extenção para consultar funções relacionadas pesquise os tópicos `??readr::read_` e `??readr::write_`.



# Trabalhando com Projetos

Existe ainda a alternativa de trabalhar com projetos (`.RProj`). Nestes, o diretório em que o arquivo `.RProj` estiver salvo, passa a ser a pasta raiz da análise. Para criar um projeto no RStudio, é necessário clicar no ícone superior à direita. 

Uma dica: use o pacote usethis::create_project()
