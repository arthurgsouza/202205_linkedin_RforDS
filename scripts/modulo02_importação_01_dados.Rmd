---
title: "Importação de Dados externos para o Ambiente R"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = TRUE)
```

# Bibliotecas

```{r}
library(tidyverse)
```


# Importação

## Dados tabulares externos

A etapa de importação de dados pode significar ler dados armazenados em arquivos de diferentes extensões, provenientes de outras ferramentas, APIs da Web, e etc. Aqui iremos dar enfoque na leitura de dados tabulares, isto é, arquivos que possuem características retangulares, como por exemplo arquivos excel ou .csv. 


### Via point-and-click
Para a leitura de arquivos tabulares, vamos primeiro considerar a opção Point-and-Click:
`File > Import Dataset > From ... `, onde você poderá definir as especificações de leitura, tendo acesso aos comandos referentes às instruções dadas. De modo que você possa não apenas importar a sua base, mas também aprender os respectivos códigos, garantindo a garantir a reprodutibilidade da leitura.  

Uma alternativa menos replicável é por meio do comando `file.choose()`, que abre um pop-up, onde você pode selecionar o seu arquivo de interesse.


```{r}
#file.choose()
```


### Via código
Apesar do R possuir várias funções default para leitura de dados, como `read.table()` por exemplo, daremos enfoque aqui as funções do pacote `readr` – uma das bibliotecas do tidyverse. Abaixo seguem alguns exemplos para a leitura de um arquivo que denominaremos de forma genérica como "file" – assumindo que este esteja no seu diretório corrente de trabalho, considerando diferentes possíveis extensões e delimitadores que este arquivo possa vir a ter:

* read_csv("file.csv") - lê arquivos delimitados por vírgula
* read_csv2("file.csv") - lê arquivos delimitados por ponto e vírgula
* read_delim("file.txt", delim="|") - lê arquivos delimitados por tabulação (exemplo dado para o delimitador |)
* read_fwf("file.fwf", col_positions = c(1,3,5)) - lê arquivos com largura fixa (exemplo dado para o padrão 1,3,5)

Importante ressaltar que em todos os casos é possível especificar características do arquivo, por meio de parâmetros como: nome das colunas, cabeçalho, linhas para serem puladas, ou ainda a pré-especificação da classe de cada uma das colunas do arquivo. Contudo, no caso deste último parâmetro não ser listado, as funções do `readr` irão “adivinhar” a classe das colunas, retornando uma mensagem com tais informações. 

Como exemplo vamos utilizar um dos arquivos de exemplo do próprio pacote:

```{r}
read_csv(readr_example("mtcars.csv"))
#dica: explore as demais opções da função `readr_example`
```

## Dados de diferentes extensões

O R dispõe de uma larga gama de bibliotecas relacionadas à leitura de dados, abaixo temos algumas opções listadas:

- readxl: para arquivos .xls e .xlsx.
- feather: para compartilhar arquivos com Python e outras linguagens.
- haven: para trabalhar com arquivos do SPSS, SAS e Stata.
- httr: para web apps.
- jsonlite: para JSON arquivos.
- rvest: para web scraping.
- xml2: para XML.


Além de  `DBI`, `sparklyr`, esta última particularmente interessante no contexto de Big Data.



## Dados dos pacotes do R

No R existe também a opção de trabalhar com as bases de dados disponíveis na própria linguagem, para consultá-las podemos utilizar a função `data()`. Adicionalmente, existem muitas bases que acompanham as bibliotecas, de modo que para cada biblioteca carregada, teremos uma atualização na lista de dados:

```{r}
data()
```

Estas bases de dados podem ser diretamente acessadas:

```{r}
AirPassengers
```


Mas para que os dados constem na janela de Environment, precisamos carregá-las por meio da função `data("AirPassengers") ` ou :

```{r}
AirPassengers <- AirPassengers
```



### Alguns pacotes legais do R para pesquisar bases de dados

Conforme comentado, temos datasets que acompanham muitas bibliotecas, além de existirem pacotes com este enfoque, alguns exemplos anteriores: 

  - `dados::` disponibiliza a tradução para português de algumas das bases de dados mais usuais no contexto de tutorias de análise/ciência de dados.

  - `charlatan::` possibilita a construção de dados falsos a partir de especificações de temas ou de caracteristicas desejadas para as variáveis.

  - `sidrar::` fornece acesso direto aos dados do SIDRA - Sistema IBGE de Recuperação Automática.

  - `microdatasus::` permite baixar dados de várias bases do Datasus (este pacote não está disponível no repositório oficial do R, o CRAN, sendo necessário fazer a instalação a partir do github).
  
  - `datasets.load::` provê uma interface para apresentar os conjuntos de dados disponíveis nos pacotes instalados (incluindo os que não estão carregados descarregados) - experimente por exemplo a função `datasets()` do pacote.


Para explorar mais opções de dataset existentes em bibliotecas do R, este aplicativo Shiny é particularmente interessante: [Find R data that you need](https://marija-stanojcic.shinyapps.io/R_datasets/), algo como "encontre os dados do R que você precisa" em português. Nele você pode pesquisar bases de dados a partir da especificação de informações como: número mínimo de observações desejadas, a presença de determinados tipo de variáveis, ou palavras-chave relacionadas. 



### Alguns sites legais para pesquisar bases de dados

Seguem algumas opções de sites em que você poderá pesquisar por bases de dados de diferentes temáticas e especialidades:

- https://basedosdados.org/ 
- https://cetic.br/pt/ 
- https://www.kaggle.com/datasets 
- https://data.world/databeats 
- https://corgis-edu.github.io/corgis/ 
- https://www.gapminder.org/data/




# Exportação

# Exportando um objeto criado 

Para exportar um objeto do R é necessário especificar o nome do objetivo que consta no seu ambiente, o nome que você deseja dar para o arquivo, bem como a extensão, por exemplo:

```{r}
#exporte os dados em um arquivo .csv
write_csv(mtcars, "base_exportada.csv")
```


Com a função `write_csv()`, também do pacote `readr` tendo como parametros o nome do objeto a ser exportado e o path, ou seja, o caminho onde você espera que o arquivo criado seja salvo. 

```{r}
state <- mtcars

#exporte os dados em um arquivo .csv
write_csv(state, "base_exportada.csv")
```


Para saber qual o diretório de trabalho corrente, utilizamos o comando `getwd()` (*get working directory*) 

```{r}
getwd()
```

Enquanto que para alterar o diretório de trabalho temos a função `setwd()` (*set working directory*).


```{r}
#C:\\Users\\natyd\\Desktop
setwd("C:/Users/natyd/Desktop")
```

Para a leitura de arquivos: `read_table`. Vamos ler o objeto que foi salvo, em um novo objeto.

```{r}
state1 <- read_csv("base_exportada.csv")
state1
```

Alternativamente podemos especificar o destino do arquivo de interesse, precedendo o nome do arquivo com o diretório desejado, p.e.: `write_delim(mtcars, file = "C:/Users/mtcars.txt")` note que trabalhamos com barras simples (`/` ou `\\`) para especificação de diretórios.

E assim como as demais funções, temos uma série de parâmetros, permitindo especificações de separadores, títulos e comentários, além de variações de extenção para consultar funções relacionadas pesquise os tópicos `??readr::read_` e `??readr::write_`.



# Trabalhando com Projetos

Conforme apresentado anteriormente, para importar/exportar arquivos que não se encontram no diretório de trabalho corrente, podemos especificar o diretório em que o arquivo se encontra ("diretorio/arquivo.ext"), ou mudar o diretório de trabalho em si (setdw()). Existe ainda uma terceira alternativa: trabalhar com a opção de projetos do RStudio (.RProj). Nesta, o diretório em que o arquivo .RProj estiver salvo, passa a ser a pasta raiz de todas as análises. Assim todas as especificações dos arquivos de input/output, scripts, e etc, podem ser setados sem a necessidade de detalhar a localização exata do diretório. Tal prática, bem como a adoção de estruturas para a organização dos arquivos, facilitam a evolução e o compartilhamento do trabalho. Para criar um projeto no RStudio, é necessário clicar no ícone superior à direita, conforme a imagem abaixo:


Existe ainda a alternativa de trabalhar com projetos (`.RProj`). Aqui, o diretório em que o arquivo `.RProj` estiver salvo, passa a ser a pasta raiz da análise. Para criar um projeto no RStudio, é necessário clicar no ícone superior à direita. 

Este recurso é especialmente importante para garantir reprodutibilidade no seu trabalho, seja para que outras pessoas consigam executar o seu código, seja você mesmo faze-lo em outro ambiente. Aqui vale comentar que replicabilidade é um dos princípios básicos do método científico, e se estamos falando de **ciência** de dados, nada mais justo, certo? 

Uma dica: explore o pacote `usethis`, particularmente a função `usethis::create_project()`. Esta cria um novo arquivo de projeto já com uma estrutura de pasta organizada. 